#!/bin/bash

echo "ğŸ‰ WriteWise MVP ì „ì²´ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸"
echo "=================================="

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
chmod +x run_backend.sh
chmod +x run_frontend.sh

echo ""
echo "ğŸ“‹ ì‹¤í–‰ ìˆœì„œ:"
echo "1. ë°±ì—”ë“œ ì„œë²„ ì‹œì‘ (í¬íŠ¸ 8000)"
echo "2. í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œì‘ (í¬íŠ¸ 3000)"
echo ""
echo "âš ï¸  ì£¼ì˜ì‚¬í•­:"
echo "- ë°±ì—”ë“œê°€ ì™„ì „íˆ ì‹œì‘ëœ í›„ í”„ë¡ íŠ¸ì—”ë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤"
echo "- ì²« ì‹¤í–‰ ì‹œ ëª¨ë¸ ë‹¤ìš´ë¡œë“œë¡œ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤"
echo "- GPUê°€ ìˆë‹¤ë©´ ìë™ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤"
echo ""

# ë°±ì—”ë“œ ì‹œì‘ (ë°±ê·¸ë¼ìš´ë“œ)
echo "ğŸš€ ë°±ì—”ë“œ ì„œë²„ ì‹œì‘ ì¤‘..."
./run_backend.sh &
BACKEND_PID=$!

# ë°±ì—”ë“œ ì‹œì‘ ëŒ€ê¸°
echo "â³ ë°±ì—”ë“œ ì„œë²„ ì‹œì‘ ëŒ€ê¸° ì¤‘..."
sleep 10

# ë°±ì—”ë“œ ìƒíƒœ í™•ì¸
echo "ğŸ” ë°±ì—”ë“œ ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘..."
if curl -s http://localhost:8000/health > /dev/null; then
    echo "âœ… ë°±ì—”ë“œ ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤"
else
    echo "âŒ ë°±ì—”ë“œ ì„œë²„ ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
    echo "ë°±ì—”ë“œ ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”"
    kill $BACKEND_PID 2>/dev/null
    exit 1
fi

# í”„ë¡ íŠ¸ì—”ë“œ ì‹œì‘
echo ""
echo "ğŸš€ í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œì‘ ì¤‘..."
./run_frontend.sh &
FRONTEND_PID=$!

echo ""
echo "ğŸ‰ WriteWise MVPê°€ ì„±ê³µì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
echo ""
echo "ğŸ“± ì ‘ì† ì£¼ì†Œ:"
echo "- í”„ë¡ íŠ¸ì—”ë“œ: http://localhost:3000"
echo "- ë°±ì—”ë“œ API: http://localhost:8000"
echo "- API ë¬¸ì„œ: http://localhost:8000/docs"
echo ""
echo "ğŸ›‘ ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”"

# ì¢…ë£Œ ì²˜ë¦¬
trap 'echo ""; echo "ğŸ›‘ ì„œë²„ ì¢…ë£Œ ì¤‘..."; kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit 0' INT

# ëŒ€ê¸°
wait 